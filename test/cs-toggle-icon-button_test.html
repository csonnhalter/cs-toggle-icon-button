<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>cs-toggle-icon-button test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../cs-toggle-icon-button.html">
  </head>
  <body>

    <test-fixture id="vanilla">
      <template>
        <cs-toggle-icon-button></cs-toggle-icon-button>
      </template>
    </test-fixture>

    <test-fixture id="notoggle">
      <template>
        <cs-toggle-icon-button notoggle></cs-toggle-icon-button>
      </template>
    </test-fixture>

    <test-fixture id="customcss">
      <template>
        <cs-toggle-icon-button icons='{"done":"add", "do":"menu"}' 
          style="--toggle-button-do-color: rgb(255, 0, 0); --toggle-button-done-color: rgb(0, 0, 255); --toggle-button-tip-background: rgb(255, 0, 0); --toggle-button-tip-text-color: rgb(0, 0, 255); --toggle-button-tip-opacity:0.5; ">
        </cs-toggle-icon-button>
      </template>
    </test-fixture>

    <test-fixture id="papercss">
      <template>
        <cs-toggle-icon-button 
          style="--paper-tooltip-background: rgb(0, 255, 0); --paper-tooltip-text-color: rgb(255, 0, 255); --paper-tooltip-opacity:0.1; ">
        </cs-toggle-icon-button>
      </template>
    </test-fixture>

    <script>
      suite('toggle element, no attributes',() => {
        let tbutton;

        setup(() => {
          tbutton = fixture('vanilla');
        });

        test('notoggle is false',() => {
      
          assert.equal(tbutton.notoggle, false);
        });

        test('default icons in use',() => {
      
          let value = tbutton.icons;

          assert.equal(value.done, "expand-less");
          assert.equal(value.do, "expand-more");
        });

        test('start with do state',() => {
      
          assert.equal(tbutton.ModeColclass, "do");
        });

        test('start with expand-more icon', () => {
      
          assert.equal(tbutton.ModeIcon, "expand-more");
        });

        test('pressing button toggles', () => {
    
          pressbutton(tbutton);

          assert.equal(tbutton.ModeColclass, "done");
          assert.equal(tbutton.ModeIcon, "expand-less");
          assert.equal(tbutton.ModeDone, true);
        });

        test('using internal defaults for tips css', () => {
          
          let tipBgColor = 'white'; 
          let tipColor = 'black'; 
          let tipOpacity = 0.9;

          let tip = tbutton.shadowRoot.querySelector('paper-tooltip');

          assert.equal(getCompStyle(tip, '--paper-tooltip-opacity'), tipOpacity);
          assert.equal(getCompStyle(tip, '--paper-tooltip-background'), tipBgColor);
          assert.equal(getCompStyle(tip, '--paper-tooltip-text-color'), tipColor);
        });
      });

      suite('notoggle element, no attributes', () => {
        
        let tbutton;

        setup( () => {
            tbutton = fixture('notoggle');
        });

        test('notoggle is true', () => {
        
          assert.equal(tbutton.notoggle, true);
        });

        test('default icons in use', () => {
            
          let value = tbutton.icons;

          assert.equal(value.done, "expand-less");
          assert.equal(value.do, "expand-more");
        });

        test('start with done state', () =>{
        
          let value = tbutton.ModeColclass;

          assert.equal(value, "done");
          assert.equal(tbutton.ModeDone, true);
        });

        test('start with expand-less icon', () =>{
    
          let value = tbutton.ModeIcon;

          assert.equal(value, "expand-less");
        });
    
        test('pressing button toggles not', () =>{
    
          let pre = tbutton;
    
          pressbutton(tbutton);
    
          assert.equal(tbutton.ModeColclass, pre.ModeColclass);
          assert.equal(tbutton.ModeIcon, pre.ModeIcon);
          assert.equal(tbutton.ModeDone, pre.ModeDone);
        });
      });

      suite('custom icons and css', () =>{
        
        let tbutton;

        setup(() =>{
          tbutton = fixture('customcss');
        });

        test('notoggle is false', () =>{
          
          let value = tbutton.notoggle;
          assert.equal(value, false);
        });
    
        test('custom icons on paper-icon-button toggle', () =>{
            
          let value = tbutton.icons;

          assert.equal(value.done, "add");
          assert.equal(value.do, "menu");

          let pbutton = tbutton.shadowRoot.querySelector('paper-icon-button');
              
          assert.equal(pbutton.icon, "menu");
          pressbutton(tbutton);
          assert.equal(pbutton.icon, "add");
        });
            
        test('start with do state', () =>{
            
          let value = tbutton.ModeColclass;

          assert.equal(value, "do");
          assert.equal(tbutton.ModeDone, false);
        });

        test('pressing button toggles to custom icon', () =>{
          
          pressbutton(tbutton);

          assert.equal(tbutton.ModeColclass, "done");
          assert.equal(tbutton.ModeIcon, "add");
          assert.equal(tbutton.ModeDone, true);
        });

        test('pressing button toggles not, if notoggle is set', () =>{

          tbutton.notoggle = true;
          pressbutton(tbutton);

          assert.equal(tbutton.ModeColclass, "do");
          assert.equal(tbutton.ModeIcon, "menu");
          assert.equal(tbutton.ModeDone, false);

          pressbutton(tbutton);

          assert.equal(tbutton.ModeColclass, "do");
          assert.equal(tbutton.ModeIcon, "menu");
          assert.equal(tbutton.ModeDone, false);
        });
        
        test('setting color with custom colors', () =>{
          let doColor = getCompStyle(tbutton, '--toggle-button-do-color');
          let doneColor = getCompStyle(tbutton, '--toggle-button-done-color');
          
          let pbutton = tbutton.shadowRoot.querySelector('paper-icon-button');

          assert.equal(tbutton.ModeColclass, "do");
          assert.equal(getCompStyle(pbutton, 'color'), doColor);
            
          
          pressbutton(tbutton);
        
          assert.equal(tbutton.ModeColclass, "done");
          assert.equal(getCompStyle(pbutton, 'color'), doneColor);  
        });

        test('setting custom tip color, background color and opacity', () => {
          
          let tipBgColor = getCompStyle(tbutton, '--toggle-button-tip-background');
          let tipColor = getCompStyle(tbutton, '--toggle-button-tip-text-color');
          let tipOpacity = getCompStyle(tbutton, '--toggle-button-tip-opacity');

          let tip = tbutton.shadowRoot.querySelector('paper-tooltip');

          assert.equal(getCompStyle(tip, '--paper-tooltip-opacity'), tipOpacity);
          assert.equal(getCompStyle(tip, '--paper-tooltip-background'), tipBgColor);
          assert.equal(getCompStyle(tip, '--paper-tooltip-text-color'), tipColor);
        });
      });
      
      suite('paper-tooltip css styling', () => {
        let tbutton;

        setup(() => {
          tbutton = fixture('papercss');
        });

        test('setting  paper-tooltip custom color, background color and opacity', () => {

          let tipBgColor = getCompStyle(tbutton, '--paper-tooltip-background');
          let tipColor = getCompStyle(tbutton, '--paper-tooltip-text-color');
          let tipOpacity = getCompStyle(tbutton, '--paper-tooltip-opacity');

          let tip = tbutton.shadowRoot.querySelector('paper-tooltip');

          assert.equal(getCompStyle(tip, '--paper-tooltip-opacity'), tipOpacity);
          assert.equal(getCompStyle(tip, '--paper-tooltip-background'), tipBgColor);
          assert.equal(getCompStyle(tip, '--paper-tooltip-text-color'), tipColor);
        });
      });

      function pressbutton(tbutton) {
        let pbutton = tbutton.shadowRoot.querySelector('paper-icon-button');
        pbutton.click();
      }

      function getCompStyle(element, property){
        if (window.ShadyCSS) {
          return ShadyCSS.getComputedStyleValue(element,property);
        }else{
          return getComputedStyle(element).getPropertyValue(property);
        }          
      }
    </script>
  </body>
</html>
